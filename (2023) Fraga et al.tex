%% 
%% Copyright 2007-2020 Elsevier Ltd
%% 
%% This file is part of the 'Elsarticle Bundle'.
%% ---------------------------------------------
%% 
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.2 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.2 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%% 
%% The list of all files belonging to the 'Elsarticle Bundle' is
%% given in the file `manifest.txt'.
%% 
%% Template article for Elsevier's document class `elsarticle'
%% with harvard style bibliographic references

\documentclass[preprint,12pt,authoryear]{elsarticle}

%% Use the option review to obtain double line spacing
%% \documentclass[authoryear,preprint,review,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,1p,times,authoryear]{elsarticle}
%% \documentclass[final,1p,times,twocolumn,authoryear]{elsarticle}
%% \documentclass[final,3p,times,authoryear]{elsarticle}
%% \documentclass[final,3p,times,twocolumn,authoryear]{elsarticle}
%% \documentclass[final,5p,times,authoryear]{elsarticle}
%% \documentclass[final,5p,times,twocolumn,authoryear]{elsarticle}

%% For including figures, graphicx.sty has been loaded in
%% elsarticle.cls. If you prefer to use the old commands
%% please give \usepackage{epsfig}

%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}
%% The amsthm package provides extended theorem environments
%% \usepackage{amsthm}

%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers}, end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers.
%% \usepackage{lineno}

\journal{Journal of Analysis, Modeling and Optimization}

\begin{document}

\begin{frontmatter}

%% Title, authors and addresses

%% use the tnoteref command within \title for footnotes;
%% use the tnotetext command for theassociated footnote;
%% use the fnref command within \author or \affiliation for footnotes;
%% use the fntext command for theassociated footnote;
%% use the corref command within \author for corresponding author footnotes;
%% use the cortext command for theassociated footnote;
%% use the ead command for the email address,
%% and the form \ead[url] for the home page:
%% \title{Title\tnoteref{label1}}
%% \tnotetext[label1]{}
%% \author{Name\corref{cor1}\fnref{label2}}
%% \ead{email address}
%% \ead[url]{home page}
%% \fntext[label2]{}
%% \cortext[cor1]{}
%% \affiliation{organization={},
%%            addressline={}, 
%%            city={},
%%            postcode={}, 
%%            state={},
%%            country={}}
%% \fntext[label3]{}

\title{Multiproduct Batch Processing Time Maximization Problem}

%% use optional labels to link authors explicitly to addresses:
%% \author[label1,label2]{}
%% \affiliation[label1]{organization={},
%%             addressline={},
%%             city={},
%%             postcode={},
%%             state={},
%%             country={}}
%%
%% \affiliation[label2]{organization={},
%%             addressline={},
%%             city={},
%%             postcode={},
%%             state={},
%%             country={}}

\author{Tatiana Balbi Fraga, Regilda Menezes and Marcos Henrique}

\affiliation{organization={Centro AcadÃªmico do Agreste - Universidade Federal de Pernambuco},
             addressline={Avenida Marielle Franco, Bairro Nova Caruaru},
             city={Caruaru},
             postcode={55014-900},
             state={PE},
             country={Brasil}}

%\affiliation{organization={},%Department and Organization
%            addressline={}, 
 %           city={},
 %           postcode={}, 
 %           state={},
 %          country={}}

\begin{abstract}
%% Text of abstract

\end{abstract}

%%Graphical abstract
\begin{graphicalabstract}
%\includegraphics{grabs}
\end{graphicalabstract}

%%Research highlights
\begin{highlights}
\item Research highlight 1
\item Research highlight 2
\end{highlights}

\begin{keyword}
multiproduct batch \sep processing time maximization \sep anal
%% keywords here, in the form: keyword \sep keyword

%% PACS codes here, in the form: \PACS code \sep code

%% MSC codes here, in the form: \MSC code \sep code
%% or \MSC[2008] code \sep code (2000 is the default)

\end{keyword}

\end{frontmatter}

%% \linenumbers

%% main text
\section{Introduction}
\label{sec:intro}

The scientific literature presents several papers that address the multi-product batch problem. Most works target the problem of multi-product batch scheduling (MPBS), in which it is necessary to determine production ordering and the ideal batch size for each product, in a production of several products which share the same production facilities and for which demand is known \citep{Eilon1985}. In this problem, a single product is processed at a time, so it is necessary that the quantity produced is sufficient to meet the demand during the period in which other products are being processed. The solution must be determined in such a way that both setup and storage costs are minimized. Among the authors who addressed this problem are \cite{Eilon1985}, \cite{Omega1993} and \cite{LiuEtAl2020}. Other important works deal with the design of a multi-product batch plant. In this case the problem is to obtain the configuration of the plant and the equipment that minimize the capital cost of all the
equipment items needed to fulfill the production requirements \citep{RavemarkAndRippin1998}. 

In this work, we are concerned with determining the ideal processing time for a batch consisting of a set of products, each product being or not different from the other products of the same batch. That is, we consider a specific case where different products are processed simultaneously on the same processor. This case occurs, for example, during the processing of plastic bags in extruders, where the resins are melted, then pass through a cylinder forming a balloon and this balloon, and after cooling, is stored in a coil which, in turn, is cut into several smaller coils, forming different models of plastic bags.

\section{Multiproduct batch processing time maximization problem}
\label{sec:MBPTMP}

The multiproduct batch processing time maximization problem arises when a set of different products are processed simultaneously in the same production batch. In this problem, it is considered that the quantity produced of each product is directly proportional to the processing time, however, with a different production rate (quantity/unit of time) for each product. In addition, there is a maximum quantity allowed for the production of batch products, defined both individually and for the set. The maximum production quantity of each product is defined according to the demand for the product. However, it is still possible to stock the products and/or send them to the outlets. In both cases, there is a stocking/shipping limit for each product and a stocking/shipping limit for the set of products in the batch. Also, there is a time limit available for processing the batch. The problem consists of defining the maximum processing time for the batch, respecting the limitations related to the quantities produced. For a better understanding of the problem, an example is presented below.

\emph{Example:} A certain machine must process a batch containing 2 different products: A and B. The production rate of A is 60 g/min while the production rate of B is 40 g/min. The factory has free stock for a maximum of 3000 g of any product, and, according to the maximum stock allowed for each product, an additional 3000 g of product A and 2000 g of product B may be stocked at the factory. There is a demand for 1000 g of product A and 500 g of product B. The factory has an outlet that has free space in stock of 1000 g, which can receive a maximum of 600 g of each product. A maximum time of 100 minutes of this machine can be allocated for processing this batch. What is the maximum possible time for processing this batch ? 

\section{Mathematical model}
\label{}

Given that: \\

$\textrm{UD}_i$ is the demand for the product $i$; \\

$\textrm{I}$ is the maximum quantity allowed for additional factory storage of all products in the batch; \\

$\textrm{UI}_i$ is the maximum quantity allowed for stocking the product $i$ in the factory; \\

$\textrm{O}$ is the maximum quantity allowed for shipment of all products to outlets; \\

$\textrm{UO}_i$ is the maximum amount of product $i$ that can be shipped to outlets; \\ 

$\textrm{p}_i$ is the production rate of product $i$; \\

$\textrm{Z}$ is the timeout for batch processing; \\

$P_i$ is the amount of product $i$ produced; \\

$D_i$ is the amount of product $i$ delivered for the demand; \\

$O_i$ amount of product $i$ shipped to factory outlets; \\

$I_i$ is the amount of product $i$ that will be stored at the factory; \\

$T$ is the batch processing time. \\

We have the problem: \\

\begin{equation}
max \quad T
\end{equation}

$s.t.$ \\

\begin{equation}
P_i - \textrm{p}_i * T  = 0 \quad \forall i
\end{equation}

\begin{equation}
P_i - D_i - O_i - I_i = 0 \quad \forall i
\end{equation}

\begin{equation}
D_i \leq \textrm{UD}_i \quad \forall i
\end{equation}

\begin{equation}
O_i \leq \textrm{UO}_i \quad \forall i
\end{equation}

\begin{equation}
\sum_i{O_i} \leq \textrm{O}
\end{equation}

\begin{equation}
I_i \leq \textrm{UI}_i \quad \forall i
\end{equation}

\begin{equation}
\sum_i{I_i} \leq \textrm{I}
\end{equation}

\begin{equation}
T \leq \textrm{Z}
\end{equation}

\begin{equation}
D_i, O_i, I_i \in  \mathbb{Z}^+ \quad \forall i
\end{equation}

where: \\

Constraints in (2) relate the quantity produced, $P_i$, to batch processing time $T$. Constraints in (3) calculate the quantity produced, $P_i$, as a function of the primary variables, $D_i$, $O_i$ and $I_i$. Constraints in (4), (5), and (7) state that the quantity delivered to demand, the quantity shipped to the autlets, and the factory-stocked quantity of each product must be less than their respective known limits. Constraints (6) and (8) state that both the sum of product quantities sent to the autlets and the sum of product quantities stored in the factory must be less than their respective maximum allowed values. The restriction in (9) establishes that there is a batch processing time limit, $Z$, that must be respected. And finally, the constraints in (10) inform the nature of the decision variables.

\section{Analytical solution}
\label{}

It is possible to consider the factory stock and the outlets stock as single stock, so we have:

\begin{equation}
E_i = O_i + I_i
\end{equation}

where $E_i$ is the sum of the quantity stored at the factory and the quantity sent to the outlets of the product $i$. \\

So that:

\begin{equation}
E_i \leq \textrm{UO}_i + \textrm{UI}_i
\end{equation}

and

\begin{equation}
\sum_i {E_i} \leq \textrm{O} + \textrm{I}
\end{equation}


It is also possible to split the batch processing time into two time slots:

\begin{equation}
T = T' + T''
\end{equation}

and consider that T' is the maximum processing time used only for production that will meet the demand. Thus, we can find T', solving the reduced problem:


\begin{equation}
max \quad T'
\end{equation}

$s.t.$ \\

\begin{equation}
D_i - \textrm{p}_i * T'  = 0 \quad \forall i
\end{equation}

\begin{equation}
D_i \leq \textrm{UD}_i \quad \forall i
\end{equation}

\begin{equation}
D_i \in  \mathbb{Z}^+ \quad \forall i
\end{equation}

This reduced problem can be rewritten in the form:

\begin{equation}
max \quad T'
\end{equation}

$s.t.$ \\

\begin{equation}
T'  \leq \textrm{UD}_i / \textrm{p}_i \quad \forall i
\end{equation}

So we have that $T'$ will be the smallest of the ratios $\textrm{UD}_i / \textrm{p}_i$ of all products. \\

Once we find the value of $T'$, we can calculate the value of unmet demand for each product after $T'$, $S_i$, through the equations in (22).

\begin{equation}
S_i = \textrm{UD}_i - \textrm{p}_i * T' \quad \forall i
\end{equation}

Now we consider that the time interval $T''$ will be used for the production of the quantities that will be stored (in the factory and in the outlets), as well as of the demand not met by the production in the first time interval, $S_i$. 

In this case, we can find $T'''$ by solving the second reduced problem:

\begin{equation}
max \quad T''
\end{equation}

$s.t.$ \\

\begin{equation}
E_i - \textrm{p}_i * T''  = 0 \quad \forall i
\end{equation}

\begin{equation}
E_i - S_i \leq \textrm{UO}_i + \textrm{UI}_i \quad \forall i
\end{equation}

\begin{equation}
\sum_i {E_i - S_i} \leq \textrm{O} + \textrm{I}
\end{equation}

\begin{equation}
E_i \in  \mathbb{Z}^+ \quad \forall i
\end{equation}

Again, using a little algebra, we can rewrite this reduced problem in the form:

\begin{equation}
max \quad T''
\end{equation}

$s.t.$ \\

\begin{equation}
T'' \leq (\textrm{UO}_i + \textrm{UI}_i + S_i) / \textrm{p}_i  \quad \forall i
\end{equation}

\begin{equation}
T'' \leq (\textrm{O} + \textrm{I} + \sum_i {S_i}) / \sum_i {\textrm{p}_i}
\end{equation}

So, being $\textrm{N}$ the number of products in the batch, we will have $\textrm{N}+1$ inequalities that limit the value of $T''$ by constants and again $T''$ will be defined by the smallest value. \\

So the solution method can be decomposed into 4 steps: \\

step 1: find $T'$, where:

\begin{equation}
T' = \min_{\forall i} \{\textrm{UD}_i / \textrm{p}_i\}
\end{equation}

step 2: calculate $S_i$ for all products. \\

step 3: find $T''$, where:

\begin{equation}
T'' = \min \{\min_{\forall i} \{(\textrm{UO}_i + \textrm{UI}_i + S_i) / \textrm{p}_i\},(\textrm{O} + \textrm{I} + \sum_i {S_i}) / \sum_i {\textrm{p}_i}\}
\end{equation}

step 4: calculate $T$, where: 

\begin{equation}
T = T' + T''
\end{equation}

\begin{equation}
T = \min \{T , Z\}
\end{equation}

It is probably possible to extend this thinking to the solution of a class of linear optimization problems. However, we will work on this concept in an upcoming paper. \\

\emph{Solution for the example presented before} \\

Applying the method for solving the example presented in section \ref{sec:MBPTMP}, we have: \\

$T' \leq 1000g / 60g/min$ \\

$T' \leq 16,67 min$ \quad for A \\

$T' \leq 500g / 40g/min$ \\

$T' \leq 12,50 min$ \quad for B \\

so: \\

$T' = 12$ \\

Then:\\

$S_A = 1000g - 12min * 60g/min = 280g$ \\

$S_B = 500g - 12min * 40g/min = 20g$ \\

And so we have: \\

$T'' \leq (3000g + 600g + 280g) / 60g/min$ \\

$T'' \leq 64,67 min$ \quad for A \\

$T'' \leq (2000g + 600g + 20g) / 40g/min$ \\

$T'' \leq 65,50 min$ \quad for B \\

$T'' \leq (1000g + 3000g + 300g) / 100g/min$ \\

$T'' \leq 43 min$ \quad for A and B \\

So that: \\

$T'' = 43 min$ \\

So we have: \\

$ T = 55 min$ \\

As $T<\textrm{Z=100}$, then this will certainly be the optimal solution. \\

In this case we will have: \\

$P_A = 3300g$ e $P_B=2200g$ \\

$D_A = 1000g$ e $D_B = 500g$ \\

$E_A = 2300g$ e $E_B = 1700g$ \\

Note that it is not important to know the values of $O_i$ and $I_i$ $\forall i$ however these values can be found by taking a solution from the indeterminate system of inequations:

\begin{equation}
\sum_i{O_i} \leq \textrm{O}
\end{equation}

\begin{equation}
\sum_i{I_i} \leq \textrm{I}
\end{equation}

\section{Tests and results}
\label{}

To test the developed model and analytical solution method, we created a solver in C++ and a solver in LINGO (both available at github.com). We tested the solvers developed for the benchmarks presented below. 

\begin{table}[h]
\begin{center}
\begin{tabular}[c]{c r r r}
$i$ & 1 & 2 & total \\
\cline {1-4} \\
$\textrm{p}_i$ & 60 & 40 & \\
$\textrm{UD}_i$ & 1000 & 500 & \\
$\textrm{UO}_i$ & 600 & 600 & 1000 \\
$\textrm{UI}_i$ & 3000 & 2000 & 3000 \\
\cline {1-4} \\
& & $\textrm{Z}$ & 100 \\
\end{tabular}
\label{tab:MBPTMP 001}
\caption{Benchmark MBPTMP 001}
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
\begin{tabular}[c]{c r r r r}
$i$ & 1 & 2 & 3 & total \\
\cline {1-5} \\
$\textrm{p}_i$ & 60 & 40 & 50 \\
$\textrm{UD}_i$ & 1000 & 500 & 800 \\
$\textrm{UO}_i$ & 600 & 600 & 600 & 1500 \\
$\textrm{UI}_i$ & 3000 & 2000 & 1000 & 3500 \\
\cline {1-5} \\
& & & $\textrm{Z}$ & 100 \\
\end{tabular}
\label{tab:MBPTMP 001}
\caption{Benchmark MBPTMP 002}
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
\begin{small}
\begin{tabular}[c]{c r r r r r r r r r r r }
$i$ & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & total \\
\cline {1-12} \\
$\textrm{p}_i$ & 60 & 40 & 50 & 40 & 30 & 50 & 60 & 10 & 20 & 40\\
$\textrm{UD}_i$ & 1000 & 500 & 800 & 500 & 400 & 500 & 2000 & 300 & 500 & 1000 \\
$\textrm{UO}_i$ & 600 & 600 & 600 & 1500 & 300 & 200 & 500 & 800 & 0 & 200 & 3000 \\
$\textrm{UI}_i$ & 3000 & 2000 & 1000 & 800 & 3000 & 1000 & 400 & 300 & 200 & 0 & 5000 \\
\cline {1-12} \\
& & & & & & & & & & $\textrm{Z}$ & 100 \\
\end{tabular}
\label{tab:MBPTMP 001}
\caption{Benchmark MBPTMP 003}
\end{small}
\end{center}
\end{table}

For building larger benchmarks, we used the following functions: \\

\begin{equation}
\textrm{p}_i = rand()\%30 + 10
\end{equation}

\begin{equation}
\textrm{UD}_i = rand()\%3000 + 800;
\end{equation}

\begin{equation}
\textrm{O} = rand()\%3000 + 500;
\end{equation}

\begin{equation}
\textrm{UO}_i = rand()\%(\textrm{O}-500) + 500;
\end{equation}

\begin{equation}
\textrm{I} = rand()\%5000 + 1000;
\end{equation}

\begin{equation}
\textrm{UI}_i = rand()\%(\textrm{I}-1000) + 1000;
\end{equation}

\begin{equation}
\textrm{Z} = 100;
\end{equation}

Seeking to enable the reproduction of the results, in the computational construction of the benchmarks we used the function srand((unsigned) source), where source is a defined value. To build the results presented in this work, we used source=0. \\

Table X presents a comparison of the results obtained by applying the analytical method and the LINGO solver for the solution of the previously presented benchmarks.

\section{Contributions}

The work for the elaboration of this paper is being carried out by three professors, as described below. Professor Fraga, T.B., was responsible for identifying the problem, mathematical modeling, proposing an analytical solution, developing a solver in C ++ for the analytical solution, developing benchmarks, and testing the analytical method and the solver in C++, as well as surveying bibliography and elaboration of the paper. Professor Henrique, M.  is developing a solver in LINGO for testing and validating the model. Professor Menezes, R. is contributing to the bibliographic survey and to writing the bibliographic review presented in the paper.


%% The Appendices part is started with the command \appendix;
%% appendix sections are then done as normal sections
%% \appendix

%% \section{}
%% \label{}

%% If you have bibdatabase file and want bibtex to generate the
%% bibitems, please use
%%
%%  \bibliographystyle{elsarticle-harv} 
%%  \bibliography{<your bibdatabase>}

%% else use the following coding to input the bibitems directly in the
%% TeX file.

\begin{thebibliography}{1}

%% \bibitem[Author(year)]{label}
%% Text of bibliographic item

\bibitem[\protect\citeauthoryear{Eilon}{1985}]{Eilon1985}
Eilon. (1985). Multi-product batch production on a single machine - A problem revisited. {\it OMEGA Int. J. of Mgmt Sci.}, Vol. 13 (5), pp. 453--468.

\bibitem[\protect\citeauthoryear{Liu et al}{2020}]{LiuEtAl2020}
Liu, G., Li, F., Yang, X., and Qiu. S. (2020). The multi-stage multi-product batch-sizing problem in the steel industry. {\it  Applied Mathematics and Computation}, Vol. 369, 124830.

\bibitem[\protect\citeauthoryear{Omega}{1993}]{Omega1993}
OMEGA Journal. (1993). Single Machine Multi-product Batch Scheduling: Testing Several Solution Methods. {\it  OMEGA Int. J. of Mgmt Sci.}, Vol. 21 (6), pp. 709--711.

\bibitem[\protect\citeauthoryear{Ravemark and Rippin}{1998}]{RavemarkAndRippin1998}
Ravemark, D. E., and Rippin, D. W. T. (1998). Optimal design of a multi-product batch plant. {\it Computers chem. Engng}, Vol. 22 (1-2), pp. 177--183.

\end{thebibliography}
\end{document}

\endinput
%%
%% End of file `elsarticle-template-harv.tex'.
